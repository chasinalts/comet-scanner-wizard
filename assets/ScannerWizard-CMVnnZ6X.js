var z=Object.defineProperty;var A=(i,r,c)=>r in i?z(i,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[r]=c;var S=(i,r,c)=>A(i,typeof r!="symbol"?r+"":r,c);import{j as e,A as O,m as w}from"./vendor-ui-B2A3YeRo.js";import{a as n}from"./vendor-react-CTBdW232.js";import{a as I,u as B,b as $,T as L}from"./index-C-jsFhPW.js";import{u as U,a as P,C as Q,T as D}from"./FormField-DjtN2c4a.js";const R={hidden:{opacity:0},visible:{opacity:1}},W={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},_=({isOpen:i,onClose:r,title:c,children:h,footer:l,size:o="md",showCloseButton:p=!0})=>{const g={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[o];return e.jsx(O,{mode:"wait",children:i&&e.jsxs(n.Fragment,{children:[e.jsx(w.div,{variants:R,initial:"hidden",animate:"visible",exit:"hidden",onClick:r,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(w.div,{variants:W,initial:"hidden",animate:"visible",exit:"exit",className:`${g} w-full bg-white rounded-lg shadow-xl`,onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:c}),p&&e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:h}),l&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:l})]})})]})})};class F{constructor(r=100){S(this,"cache");S(this,"maxSize");this.cache=new Map,this.maxSize=r}get(r){const c=this.cache.get(r);if(c){if(c.expiry&&Date.now()>c.expiry){this.cache.delete(r);return}return this.cache.delete(r),this.cache.set(r,c),c.value}}set(r,c,h=null){if(this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;this.cache.delete(o)}const l=h?Date.now()+h:null;this.cache.set(r,{value:c,expiry:l})}clear(){this.cache.clear()}}function j(i,r={}){const{maxCacheSize:c=100,ttl:h=null}=r,l=new F(c),o=(...p)=>{const g=JSON.stringify(p),f=l.get(g);if(f!==void 0)return f;const u=i(...p);return u instanceof Promise?(l.set(g,u,h),u.then(v=>(l.set(g,v,h),v)).catch(v=>{throw l.get(g)===u&&l.set(g,void 0,0),v})):(l.set(g,u,h),u)};return o.clearCache=()=>{l.clear()},o}const J=()=>{const[i,r]=n.useState([]);n.useEffect(()=>{const t=()=>{const a=localStorage.getItem("admin_contents");a&&r(JSON.parse(a))};t();const s=a=>{a.key==="admin_contents"&&t()};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const c=n.useMemo(()=>j(t=>t.filter(s=>s.type==="banner")),[]),h=n.useCallback(()=>{const t=c(i);if(t.length===0)return null;const s=t[t.length-1];return{id:s.id,src:s.imageUrl||"",alt:s.title,scale:s.scale,displayText:s.displayText}},[i,c]),l=n.useMemo(()=>j(t=>t.filter(s=>s.type==="scanner")),[]),o=n.useMemo(()=>j(t=>[...t].sort((s,a)=>a.updatedAt-s.updatedAt)),[]),p=n.useMemo(()=>j(t=>t.map(s=>({id:s.id,src:s.imageUrl||"",alt:s.title,scale:s.scale,displayText:s.displayText}))),[]),g=n.useCallback(()=>{const t=l(i),s=o(t);return p(s)},[i,l,o,p]),f=n.useMemo(()=>j(t=>t.filter(s=>s.type==="template")),[]),u=n.useMemo(()=>j(t=>t.map(s=>({id:s.id,title:s.title,code:s.content}))),[]),v=n.useCallback(()=>{const t=f(i),s=o(t);return u(s)},[i,f,o,u]),x=n.useMemo(()=>j(t=>t.filter(s=>s.type==="question")),[]),d=n.useMemo(()=>j(t=>t.map(s=>({id:s.id,title:s.title,text:s.content}))),[]),m=n.useCallback(()=>{const t=x(i),s=o(t);return d(s)},[i,x,o,d]);return n.useMemo(()=>({getBannerImage:h,getScannerImages:g,getTemplates:v,getQuestions:m,hasContent:i.length>0}),[h,g,v,m,i.length])},Y=()=>{const{state:i}=I(),{answers:r,sections:c,questions:h}=i,l=n.useMemo(()=>j(x=>x.filter(d=>d.isMandatory)),[]),o=n.useMemo(()=>j((x,d)=>x.find(m=>m.id===d)),[]),p=n.useMemo(()=>j((x,d)=>x.find(m=>m.id===d)),[]),g=n.useCallback((x,d,m)=>{const b=new RegExp(`{{\\s*${d}\\s*}}`,"g");return x.replace(b,m)},[]),f=n.useCallback(x=>{let d="";const m=new Set;return x.forEach(b=>{d+=`// --- Section: ${b.title} (Mandatory) ---
`,d+=b.code+`

`,m.add(b.id)}),{code:d,includedIds:m}},[]),u=n.useCallback((x,d,m,b)=>{let t="";return Object.entries(x).forEach(([s,a])=>{const y=o(d,s);if(!y)return;let k;if(y.type==="choice"&&a?(Array.isArray(a)?a:[a]).forEach(C=>{const M=y.options?.find(E=>E.value===C);M?.linkedSectionId&&(k=M.linkedSectionId)}):(y.type==="text"||y.type==="boolean")&&y.linkedSectionId&&(k=y.linkedSectionId),k&&!b.has(k)){const N=p(m,k);if(N){let C=N.code;y.type==="text"&&y.placeholderVariable&&typeof a=="string"&&(C=g(C,y.placeholderVariable,a)),t+=`// --- Section: ${N.title} (Linked by: ${y.text.substring(0,20)}...) ---
`,t+=C+`

`,b.add(N.id)}}else y.type==="text"&&y.placeholderVariable&&typeof a=="string"&&!k&&(t+=`// User input for "${y.text.substring(0,20)}...": ${a}

`)}),t},[o,p,g]),v=n.useMemo(()=>{const x=l(c),{code:d,includedIds:m}=f(x),b=u(r,h,c,m);return(d+b).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[r,c,h,l,f,u]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:v})})]})},K={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},T={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},Z=()=>{const{getBannerImage:i,getScannerImages:r}=J(),{currentUser:c}=B(),{theme:h}=$(),{state:l,dispatch:o}=I(),{questions:p}=U(),{sections:g}=P(),[f,u]=n.useState(null),[v,x]=n.useState("");n.useEffect(()=>{o({type:"SET_QUESTIONS",payload:p})},[p,o]),n.useEffect(()=>{o({type:"SET_SECTIONS",payload:g})},[g,o]);const d=i();r();const m=(t,s)=>{o({type:"SET_ANSWER",payload:{questionId:t,value:s}})},b=t=>{const s=l.answers[t.id];switch(t.type){case"text":return e.jsx(D,{label:t.text,value:s||"",onChange:a=>m(t.id,a.target.value),required:t.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.text," ",t.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:t.options?.map(a=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer 
                    transition-all duration-150 ease-in-out
                    ${s===a.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:t.id,value:a.value,checked:s===a.value,onChange:()=>m(t.id,a.value),className:"sr-only"}),a.imageUrl&&e.jsx("img",{src:a.imagePreview||a.imageUrl,alt:a.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${a.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:a.text})]},a.id))})]});case"boolean":return e.jsx(Q,{label:t.text,checked:!!s,onChange:a=>m(t.id,a.target.checked),required:t.required});default:return null}};return e.jsx("div",{className:h==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200",children:[e.jsx(L,{}),e.jsxs(w.div,{variants:K,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(w.div,{variants:T,className:"py-12 px-4 text-center",children:e.jsxs("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-bold text-gray-900 dark:text-white font-display tracking-tight",children:["COMET Scanner",e.jsx("br",{}),"Template Wizard"]})}),e.jsx(w.div,{variants:T,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800",children:d?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("img",{src:d.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${d.scale||1})`,transformOrigin:"center center"}})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold",children:"Visualize Your Data with COMET Scanner"})})})}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(w.div,{variants:T,children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-6",children:"Configure Your Template"}),e.jsxs("div",{className:"space-y-6",children:[l.questions.map(t=>e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:b(t)},t.id)),l.questions.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions configured yet. Please set them up in the Admin Dashboard."})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Y,{})})]})]}),f&&e.jsx(_,{isOpen:!0,onClose:()=>{u(null),x("")},title:v,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("img",{src:f,alt:v,className:"max-w-full max-h-[80vh] object-contain"})})})})]})})};export{Z as default};

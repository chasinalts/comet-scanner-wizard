import{a as p,d as $,j as e,m as b,A as z}from"./vendor-BWCFR02q.js";import{i as D,s as L,u as B,d as M,e as R,c as V}from"./index-BDHP0l7E.js";import{h as H}from"./imageHandlers-mTahlW39.js";const W=()=>e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},className:"relative w-8 h-8",children:e.jsx(b.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"absolute inset-0 border-2 border-blue-500 dark:border-blue-400 rounded-full border-t-transparent"})}),O=()=>e.jsx("svg",{className:"w-6 h-6 text-gray-400 dark:text-gray-500 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),T=()=>e.jsx(b.svg,{initial:{scale:1},animate:{scale:[1,1.1,1]},transition:{duration:1.5,repeat:1/0},className:"w-8 h-8 text-blue-500 dark:text-blue-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m0-16l-4 4m4-4l4 4"})}),P=()=>e.jsx(b.svg,{initial:{scale:0},animate:{scale:1},className:"w-8 h-8 text-red-500 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});function A({onFileSelect:c,accept:s="image/*",maxSize:f=5,title:y="Upload File",description:h="Drag and drop a file here, or click to select",variant:I="default",isLoading:o=!1}){const[u,l]=p.useState(!1),[m,t]=p.useState(null),r=$.useRef(null),d=x=>x.size>f*1024*1024?{type:"size",message:`File size exceeds ${f}MB limit`}:!s.includes("*")&&!s.includes(x.type)?{type:"type",message:"Invalid file type"}:null,w=p.useCallback(x=>{if(x.preventDefault(),l(!1),t(null),o)return;const a=x.dataTransfer.files[0];if(a){const n=d(a);if(n){t(n);return}c(a)}},[c,f,s,o]),v=p.useCallback(x=>{x.preventDefault(),o||(l(!0),t(null))},[o]),g=p.useCallback(x=>{x.preventDefault(),l(!1)},[]),N=()=>{var x;o||(t(null),(x=r.current)==null||x.click())},F=x=>{var n;if(o)return;const a=(n=x.target.files)==null?void 0:n[0];if(a){const i=d(a);if(i){t(i);return}c(a)}x.target.value=""},j=I==="compact";return e.jsxs(b.div,{onClick:N,onDrop:w,onDragOver:v,onDragLeave:g,initial:{opacity:0},animate:{opacity:1,borderColor:u?"#3B82F6":m?"#EF4444":void 0,scale:u?1.02:1},transition:{duration:.2},className:`
        relative cursor-pointer
        ${j?"p-3":"p-6"}
        rounded-lg border-2 border-dashed
        ${o?"cursor-wait ":""}
        ${m?"border-red-500 bg-red-50 dark:bg-red-900/20":u?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}
        transition-colors duration-200
      `,children:[e.jsx("input",{ref:r,type:"file",accept:s,onChange:F,className:"hidden",disabled:o}),e.jsx(z,{mode:"wait",children:o?e.jsxs(b.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 flex flex-col items-center justify-center bg-white/50 dark:bg-gray-800/50 rounded-lg backdrop-blur-sm",children:[e.jsx(W,{}),e.jsx(b.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"text-blue-500 dark:text-blue-400 font-medium mt-2",children:"Uploading..."})]},"loading"):m?e.jsxs(b.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 flex flex-col items-center justify-center bg-red-50/50 dark:bg-red-900/30 rounded-lg backdrop-blur-sm",children:[e.jsx(P,{}),e.jsxs(b.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"text-red-500 dark:text-red-400 font-medium text-center",children:[m.message,e.jsx("p",{className:"text-sm mt-1 text-red-400 dark:text-red-300",children:"Click or drag a new file to try again"})]})]},"error"):u?e.jsxs(b.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 flex flex-col items-center justify-center bg-blue-50/50 dark:bg-blue-900/30 rounded-lg backdrop-blur-sm",children:[e.jsx(T,{}),e.jsx(b.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"text-blue-500 dark:text-blue-400 font-medium",children:"Drop to upload"})]},"dragging"):e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:`text-center ${j?"space-y-1":"space-y-2"}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(O,{}),e.jsx("div",{className:`${j?"text-sm":"text-base"} font-medium text-gray-900 dark:text-white`,children:y}),e.jsx("p",{className:`${j?"text-xs":"text-sm"} text-gray-500 dark:text-gray-400`,children:h}),e.jsxs("p",{className:`${j?"text-xs":"text-sm"} text-gray-400 dark:text-gray-500`,children:["Max size: ",f,"MB"]})]})},"normal")})]})}const q=()=>{const[c,s]=p.useState(!1),[f,y]=p.useState(null);return{addImage:async(u,l,m="scanner")=>{s(!0),y(null);try{if(l.length>1e6){const t=await L.uploadImage(u,l);await D.addImage(u,t,m)}else await D.addImage(u,l,m)}catch(t){const r=t instanceof Error?t.message:"Unknown error occurred";throw y(r),t}finally{s(!1)}},getImage:async u=>{s(!0),y(null);try{return await D.getImage(u)}catch(l){const m=l instanceof Error?l.message:"Unknown error occurred";y(m);return}finally{s(!1)}},deleteImage:async u=>{s(!0),y(null);try{const l=await D.getImage(u);l&&l.startsWith("https://")&&await L.deleteImage(u),await D.deleteImage(u)}catch(l){const m=l instanceof Error?l.message:"Unknown error occurred";throw y(m),l}finally{s(!1)}},isLoading:c,error:f}},Y=()=>{const{currentUser:c}=B(),[s,f]=p.useState([]),[y,h]=p.useState(!0),[I,o]=p.useState(null);return p.useEffect(()=>{(async()=>{h(!0);try{const r=c==null?void 0:c.username,d=await M.getContents(r);f(d)}catch(r){const d=r instanceof Error?r.message:"Unknown error occurred";o(d),console.error("[Firebase] Failed to load contents:",r)}finally{h(!1)}})()},[c]),{contents:s,setContents:f,saveContent:async t=>{h(!0),o(null);try{const r=c==null?void 0:c.username;await M.saveContent(t,r),f(d=>{const w=d.findIndex(v=>v.id===t.id);if(w>=0){const v=[...d];return v[w]=t,v}else return[...d,t]})}catch(r){const d=r instanceof Error?r.message:"Unknown error occurred";throw o(d),r}finally{h(!1)}},deleteContent:async t=>{h(!0),o(null);try{await M.deleteContent(t),f(r=>r.filter(d=>d.id!==t))}catch(r){const d=r instanceof Error?r.message:"Unknown error occurred";throw o(d),r}finally{h(!1)}},saveAllContents:async()=>{h(!0),o(null);try{const t=c==null?void 0:c.username;await M.saveContents(s,t)}catch(t){const r=t instanceof Error?t.message:"Unknown error occurred";throw o(r),t}finally{h(!1)}},isLoading:y,error:I}},X=()=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-gray-900 dark:text-white",children:"Admin Dashboard"}),e.jsx(G,{})]}),G=()=>{const{currentUser:c}=B(),{showToast:s}=R(),{theme:f}=V(),{addImage:y,getImage:h,deleteImage:I}=q(),{contents:o,saveContent:u,deleteContent:l}=Y(),[m,t]=p.useState(null),[r,d]=p.useState(),[w,v]=p.useState({}),g=o.find(a=>a.type==="banner"),N=o.filter(a=>a.type==="scanner").sort((a,n)=>n.updatedAt-a.updatedAt);p.useEffect(()=>{g!=null&&g.imageId&&!r&&(console.log("[Image Load] Loading banner image:",g.imageId),h(g.imageId).then(a=>{a?(console.log("[Image Load] Banner image loaded successfully"),d(a)):console.warn("[Image Load] Banner image not found in Firebase")}).catch(a=>{console.error("[Image Load] Failed to load banner image:",a),s("error","Failed to load banner image")}))},[g==null?void 0:g.imageId,r,h,s]),p.useEffect(()=>{N.forEach(a=>{a.imageId&&!w[a.imageId]&&(console.log("[Image Load] Loading scanner image:",a.imageId),h(a.imageId).then(n=>{n?(console.log("[Image Load] Scanner image loaded:",a.imageId),v(i=>({...i,[a.imageId]:n}))):console.warn("[Image Load] Scanner image not found:",a.imageId)}).catch(n=>{console.error("[Image Load] Failed to load scanner image:",n),s("error","Failed to load scanner image")}))})},[N,w,h,s]);const F=async(a,n)=>{if(n)try{t({type:a,progress:0}),await new Promise((i,k)=>{H(n,async S=>{console.log("[Upload] Image processed successfully");const C=`${a}-${Date.now()}`;try{await y(C,S,a),console.log("[Upload] Image stored in Firebase:",C);const E={id:crypto.randomUUID(),type:a,title:n.name,content:"",imageId:C,scale:1,createdAt:Date.now(),updatedAt:Date.now()};a==="banner"&&g&&(await l(g.id),g.imageId&&await I(g.imageId)),await u(E),a==="banner"?d(S):v(U=>({...U,[C]:S})),i()}catch(E){console.error("[Upload] Failed to store content:",E),k(E)}})}),s("success",`${a==="banner"?"Banner":"Scanner"} image uploaded successfully`)}catch(i){console.error("[Upload] Content upload failed:",i),t(k=>k?{...k,error:"Upload failed"}:null),s("error","Failed to upload content")}finally{t(null)}},j=async(a,n)=>{try{console.log("[Delete] Deleting content:",{id:a,type:n});const i=o.find(k=>k.id===a);i!=null&&i.imageId&&(await I(i.imageId),console.log("[Delete] Image deleted from Firebase:",i.imageId),i.type==="banner"?d(void 0):v(k=>{const{[i.imageId]:S,...C}=k;return C})),await l(a),s("success","Content deleted successfully")}catch(i){console.error("[Delete] Failed to delete content:",i),s("error","Failed to delete content")}},x=async(a,n)=>{console.log("[Scale] Updating scale:",{id:a.id,scale:n});try{const i={...a,scale:n,updatedAt:Date.now()};await u(i),s("success","Scale updated successfully")}catch(i){console.error("[Scale] Failed to save scale update:",i),s("error","Failed to save scale change")}};return c!=null&&c.isOwner?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Banner Image"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Upload a banner image to display at the top of the main page."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(A,{onFileSelect:a=>F("banner",a),accept:"image/*",maxSize:5*1024*1024,loading:(m==null?void 0:m.type)==="banner",label:"Drag & drop a banner image or click to browse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200",children:"Current Banner"}),g&&r?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:r,alt:"Banner",className:"w-full h-auto rounded-lg border border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:e.jsx("button",{onClick:()=>j(g.id,"banner"),className:"bg-red-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300","aria-label":"Delete banner",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),g.scale!==void 0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Scale: ",g.scale.toFixed(1)]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:g.scale,onChange:a=>x(g,parseFloat(a.target.value)),className:"w-full"})]})]}):e.jsx("div",{className:"border border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center text-gray-500 dark:text-gray-400",children:"No banner image uploaded"})]})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Scanner Variations"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Upload images of different scanner variations to display on the main page."}),e.jsx("div",{className:"mb-6",children:e.jsx(A,{onFileSelect:a=>F("scanner",a),accept:"image/*",maxSize:5*1024*1024,loading:(m==null?void 0:m.type)==="scanner",label:"Drag & drop a scanner image or click to browse"})}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:"Current Scanner Images"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[N.map(a=>e.jsx("div",{className:"relative group bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:w[a.imageId]?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative aspect-square overflow-hidden rounded-lg mb-2",children:[e.jsx("img",{src:w[a.imageId],alt:a.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center",children:e.jsx("button",{onClick:()=>j(a.id,"scanner"),className:"bg-red-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300","aria-label":"Delete scanner image",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 truncate mb-1",children:a.title}),a.scale!==void 0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Scale: ",a.scale.toFixed(1)]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:a.scale,onChange:n=>x(a,parseFloat(n.target.value)),className:"w-full"})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})})},a.id)),N.length===0&&e.jsx("div",{className:"col-span-full border border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center text-gray-500 dark:text-gray-400",children:"No scanner images uploaded"})]})]})]}):e.jsx("div",{className:"p-8 text-center text-gray-900 dark:text-white",children:"You don't have permission to access this page."})};export{X as default};
//# sourceMappingURL=AdminDashboard-JsnqKgeN.js.map

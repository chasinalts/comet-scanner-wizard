var z=Object.defineProperty;var A=(l,r,n)=>r in l?z(l,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[r]=n;var S=(l,r,n)=>A(l,typeof r!="symbol"?r+"":r,n);import{j as e,A as O,m as w}from"./vendor-ui-B2A3YeRo.js";import{a as i}from"./vendor-react-CTBdW232.js";import{a as I,u as B,b as $,T as L}from"./index-CMXC3hw9.js";import{u as P,a as U,C as Q,T as D}from"./FormField-DjtN2c4a.js";const R={hidden:{opacity:0},visible:{opacity:1}},W={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},_=({isOpen:l,onClose:r,title:n,children:o,footer:c,size:d="md",showCloseButton:f=!0})=>{const h={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[d];return e.jsx(O,{mode:"wait",children:l&&e.jsxs(i.Fragment,{children:[e.jsx(w.div,{variants:R,initial:"hidden",animate:"visible",exit:"hidden",onClick:r,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(w.div,{variants:W,initial:"hidden",animate:"visible",exit:"exit",className:`${h} w-full bg-white rounded-lg shadow-xl`,onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:n}),f&&e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:o}),c&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:c})]})})]})})};class F{constructor(r=100){S(this,"cache");S(this,"maxSize");this.cache=new Map,this.maxSize=r}get(r){const n=this.cache.get(r);if(n){if(n.expiry&&Date.now()>n.expiry){this.cache.delete(r);return}return this.cache.delete(r),this.cache.set(r,n),n.value}}set(r,n,o=null){if(this.cache.size>=this.maxSize){const d=this.cache.keys().next().value;d&&this.cache.delete(d)}const c=o?Date.now()+o:null;this.cache.set(r,{value:n,expiry:c})}clear(){this.cache.clear()}}function j(l,r={}){const{maxCacheSize:n=100,ttl:o=null}=r,c=new F(n),d=(...f)=>{const h=JSON.stringify(f),b=c.get(h);if(b!==void 0)return b;const y=l(...f);return y instanceof Promise?(c.set(h,y,o),y.then(v=>(c.set(h,v,o),v)).catch(v=>{throw c.get(h)===y&&c.set(h,void 0,0),v})):(c.set(h,y,o),y)};return d.clearCache=()=>{c.clear()},d}const J=()=>{const[l,r]=i.useState([]);i.useEffect(()=>{const t=()=>{const u=localStorage.getItem("admin_contents");u&&r(JSON.parse(u))};t();const s=u=>{u.key==="admin_contents"&&t()};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[]);const n=i.useMemo(()=>j(t=>t.filter(s=>s.type==="banner")),[]),o=i.useCallback(()=>{const t=n(l);if(t.length===0)return null;const s=t[t.length-1];return{id:s.id,src:s.imageUrl||"",alt:s.title,scale:s.scale,displayText:s.displayText}},[l,n]),c=i.useMemo(()=>j(t=>t.filter(s=>s.type==="scanner")),[]),d=i.useMemo(()=>j(t=>[...t].sort((s,u)=>u.updatedAt-s.updatedAt)),[]),f=i.useMemo(()=>j(t=>t.map(s=>({id:s.id,src:s.imageUrl||"",alt:s.title,scale:s.scale,displayText:s.displayText}))),[]),h=i.useCallback(()=>{const t=c(l),s=d(t);return f(s)},[l,c,d,f]),b=i.useMemo(()=>j(t=>t.filter(s=>s.type==="template")),[]),y=i.useMemo(()=>j(t=>t.map(s=>({id:s.id,title:s.title,code:s.content}))),[]),v=i.useCallback(()=>{const t=b(l),s=d(t);return y(s)},[l,b,d,y]),m=i.useMemo(()=>j(t=>t.filter(s=>s.type==="question")),[]),x=i.useMemo(()=>j(t=>t.map(s=>({id:s.id,title:s.title,text:s.content}))),[]),a=i.useCallback(()=>{const t=m(l),s=d(t);return x(s)},[l,m,d,x]);return i.useMemo(()=>({getBannerImage:o,getScannerImages:h,getTemplates:v,getQuestions:a,hasContent:l.length>0}),[o,h,v,a,l.length])},Y=()=>{const{state:l}=I(),{answers:r,sections:n,questions:o}=l,c=i.useMemo(()=>j(m=>m.filter(x=>x.isMandatory)),[]),d=i.useMemo(()=>j((m,x)=>m.find(a=>a.id===x)),[]),f=i.useMemo(()=>j((m,x)=>m.find(a=>a.id===x)),[]),h=i.useCallback((m,x,a)=>{const g=new RegExp(`{{\\s*${x}\\s*}}`,"g");return m.replace(g,a)},[]),b=i.useCallback(m=>{let x="";const a=new Set;return m.forEach(g=>{x+=`// --- Section: ${g.title} (Mandatory) ---
`,x+=g.code+`

`,a.add(g.id)}),{code:x,includedIds:a}},[]),y=i.useCallback((m,x,a,g)=>{let t="";return Object.entries(m).forEach(([s,u])=>{const p=d(x,s);if(!p)return;let k;if(p.type==="choice"&&u?(Array.isArray(u)?u:[u]).forEach(C=>{const M=p.options?.find(E=>E.value===C);M?.linkedSectionId&&(k=M.linkedSectionId)}):(p.type==="text"||p.type==="boolean")&&p.linkedSectionId&&(k=p.linkedSectionId),k&&!g.has(k)){const N=f(a,k);if(N){let C=N.code;p.type==="text"&&p.placeholderVariable&&typeof u=="string"&&(C=h(C,p.placeholderVariable,u)),t+=`// --- Section: ${N.title} (Linked by: ${p.text.substring(0,20)}...) ---
`,t+=C+`

`,g.add(N.id)}}else p.type==="text"&&p.placeholderVariable&&typeof u=="string"&&!k&&(t+=`// User input for "${p.text.substring(0,20)}...": ${u}

`)}),t},[d,f,h]),v=i.useMemo(()=>{const m=c(n),{code:x,includedIds:a}=b(m),g=y(r,o,n,a);return(x+g).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[r,n,o,c,b,y]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:v})})]})},K={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},T={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},Z=()=>{const{getBannerImage:l}=J();B();const{theme:r}=$(),{state:n,dispatch:o}=I(),{questions:c}=P(),{sections:d}=U(),[f,h]=i.useState(null),[b,y]=i.useState("");i.useEffect(()=>{o({type:"SET_QUESTIONS",payload:c})},[c,o]),i.useEffect(()=>{o({type:"SET_SECTIONS",payload:d})},[d,o]);const v=l(),m=(a,g)=>{o({type:"SET_ANSWER",payload:{questionId:a,value:g}})},x=a=>{const g=n.answers[a.id];switch(a.type){case"text":return e.jsx(D,{label:a.text,value:g||"",onChange:t=>m(a.id,t.target.value),required:a.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.text," ",a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:a.options?.map(t=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${g===t.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:a.id,value:t.value,checked:g===t.value,onChange:()=>m(a.id,t.value),className:"sr-only"}),t.imageUrl&&e.jsx("img",{src:t.imagePreview||t.imageUrl,alt:t.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${t.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:t.text})]},t.id))})]});case"boolean":return e.jsx(Q,{label:a.text,checked:!!g,onChange:t=>m(a.id,t.target.checked),required:a.required});default:return null}};return e.jsx("div",{className:r==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200",children:[e.jsx(L,{}),e.jsxs(w.div,{variants:K,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(w.div,{variants:T,className:"py-12 px-4 text-center",children:e.jsxs("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-bold text-gray-900 dark:text-white font-display tracking-tight",children:["COMET Scanner",e.jsx("br",{}),"Template Wizard"]})}),e.jsx(w.div,{variants:T,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800",children:v?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("img",{src:v.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${v.scale||1})`,transformOrigin:"center center"}})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold",children:"Visualize Your Data with COMET Scanner"})})})}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(w.div,{variants:T,children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-6",children:"Configure Your Template"}),e.jsxs("div",{className:"space-y-6",children:[n.questions.map(a=>e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:x(a)},a.id)),n.questions.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions configured yet. Please set them up in the Admin Dashboard."})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Y,{})})]})]}),f&&e.jsx(_,{isOpen:!0,onClose:()=>{h(null),y("")},title:b,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("img",{src:f,alt:b,className:"max-w-full max-h-[80vh] object-contain"})})})})]})})};export{Z as default};

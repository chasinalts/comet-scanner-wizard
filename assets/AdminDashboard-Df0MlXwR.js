const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/useImageDB-Cn_3ys7i.js","assets/vendor-other-B8UD1HAJ.js"])))=>i.map(i=>d[i]);
import{r as h,d as W,j as e}from"./vendor-react-CSSImZ_M.js";import{d as v,s as O,i as C,u as P,c as $,e as H,b as K}from"./index-CWG-StBO.js";import{m as y,A as G}from"./vendor-framer-Cbqpt-xa.js";import{m as M,d as A,a as U,b as F,h as J}from"./imageHandlers-DRbJWnBu.js";import{_ as q}from"./vendor-supabase-Be-ScRHE.js";import"./vendor-other-B8UD1HAJ.js";const T=()=>e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},className:"relative w-8 h-8",children:e.jsx(y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"absolute inset-0 border-2 border-blue-500 dark:border-blue-400 rounded-full border-t-transparent"})}),Y=()=>e.jsx("svg",{className:"w-6 h-6 text-gray-400 dark:text-gray-500 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),Q=()=>e.jsx(y.svg,{initial:{scale:1},animate:{scale:[1,1.1,1]},transition:{duration:1.5,repeat:1/0},className:"w-8 h-8 text-blue-500 dark:text-blue-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m0-16l-4 4m4-4l4 4"})}),X=()=>e.jsx(y.svg,{initial:{scale:0},animate:{scale:1},className:"w-8 h-8 text-red-500 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});function V({onFileSelect:m,accept:c="image/*",maxSize:b=5,title:p="Upload File",description:x="Drag and drop a file here, or click to select",variant:S="default",isLoading:u=!1,label:s}){s&&(p=s);const[t,d]=h.useState(!1),[r,n]=h.useState(null),i=W.useRef(null),I=o=>o.size>b*1024*1024?{type:"size",message:`File size exceeds ${b}MB limit`}:!c.includes("*")&&!c.includes(o.type)?{type:"type",message:"Invalid file type"}:null,g=h.useCallback(o=>{if(o.preventDefault(),d(!1),n(null),u)return;const l=o.dataTransfer.files[0];if(l){const f=I(l);if(f){n(f);return}m(l)}},[m,b,c,u]),N=h.useCallback(o=>{o.preventDefault(),u||(d(!0),n(null))},[u]),L=h.useCallback(o=>{o.preventDefault(),d(!1)},[]),B=()=>{var o;u||(n(null),(o=i.current)==null||o.click())},E=o=>{var f;if(u)return;const l=(f=o.target.files)==null?void 0:f[0];if(l){const w=I(l);if(w){n(w);return}m(l)}o.target.value=""},a=S==="compact";return e.jsxs(y.div,{onClick:B,onDrop:g,onDragOver:N,onDragLeave:L,initial:{opacity:0},animate:{opacity:1,borderColor:t?"#3B82F6":r?"#EF4444":void 0,scale:t?1.02:1},transition:{duration:.2},className:`
        relative cursor-pointer
        ${a?"p-3":"p-6"}
        rounded-lg border-2 border-dashed
        ${u?"cursor-wait ":""}
        ${r?"border-red-500 bg-red-50 dark:bg-red-900/20":t?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}
        transition-colors duration-200
      `,children:[e.jsx("input",{ref:i,type:"file",accept:c,onChange:E,className:"hidden",disabled:u}),e.jsx(G,{mode:"wait",children:u?e.jsxs(y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 flex flex-col items-center justify-center bg-white/50 dark:bg-gray-800/50 rounded-lg backdrop-blur-sm",children:[e.jsx(T,{}),e.jsx(y.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"text-blue-500 dark:text-blue-400 font-medium mt-2",children:"Uploading..."})]},"loading"):r?e.jsxs(y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 flex flex-col items-center justify-center bg-red-50/50 dark:bg-red-900/30 rounded-lg backdrop-blur-sm",children:[e.jsx(X,{}),e.jsxs(y.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"text-red-500 dark:text-red-400 font-medium text-center",children:[r.message,e.jsx("p",{className:"text-sm mt-1 text-red-400 dark:text-red-300",children:"Click or drag a new file to try again"})]})]},"error"):t?e.jsxs(y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 flex flex-col items-center justify-center bg-blue-50/50 dark:bg-blue-900/30 rounded-lg backdrop-blur-sm",children:[e.jsx(Q,{}),e.jsx(y.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"text-blue-500 dark:text-blue-400 font-medium",children:"Drop to upload"})]},"dragging"):e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:`text-center ${a?"space-y-1":"space-y-2"}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Y,{}),e.jsx("div",{className:`${a?"text-sm":"text-base"} font-medium text-gray-900 dark:text-white`,children:p}),e.jsx("p",{className:`${a?"text-xs":"text-sm"} text-gray-500 dark:text-gray-400`,children:x}),e.jsxs("p",{className:`${a?"text-xs":"text-sm"} text-gray-400 dark:text-gray-500`,children:["Max size: ",b,"MB"]})]})},"normal")})]})}const Z=()=>{const[m,c]=h.useState(!1),[b,p]=h.useState(null);return{addImage:async(s,t,d="scanner")=>M("addImage",async()=>{c(!0),p(null),A("addImage",{id:s,contentType:d,dataLength:t.length,dataSizeKB:(t.length/1024).toFixed(2),dataSizeMB:(t.length/1024/1024).toFixed(2)}),console.log(`[Supabase] Starting image upload for ID: ${s}, Content Type: ${d}`),console.log(`[Supabase] Image data length: ${t.length} characters`);try{if(t.length>1e6){v.image(`Image is large (${(t.length/1024/1024).toFixed(2)}MB), using Storage`,{id:s,contentType:d,size:t.length},"SupabaseStorage"),console.log(`[Supabase] Image is large (${(t.length/1024/1024).toFixed(2)}MB), using Storage`);try{const r=await O.uploadImage(s,t);U(s,"Supabase",!0,{storageType:"Storage",urlLength:r.length,urlPrefix:r.substring(0,50)+"..."}),console.log(`[Supabase] Successfully uploaded to Storage, URL: ${r.substring(0,50)}...`),await C.addImage(s,r,d),v.supabase("Stored URL reference in database",{id:s,contentType:d,isReference:!0},"SupabaseDB"),console.log("[Supabase] Successfully stored URL reference in database")}catch(r){F("Storage upload",r),console.error("[Supabase] Storage upload failed:",r),v.warn("Falling back to direct database storage",{id:s,contentType:d,error:r instanceof Error?r.message:"Unknown error"},"SupabaseFallback"),console.log("[Supabase] Falling back to direct database storage"),await C.addImage(s,t,d),U(s,"Supabase",!0,{storageType:"Database",dataLength:t.length,fallbackFromStorage:!0})}}else v.image(`Image is small (${(t.length/1024).toFixed(2)}KB), storing directly in database`,{id:s,contentType:d,size:t.length},"SupabaseDB"),console.log(`[Supabase] Image is small (${(t.length/1024).toFixed(2)}KB), storing directly in database`),await C.addImage(s,t,d),U(s,"Supabase",!0,{storageType:"Database",dataLength:t.length}),console.log("[Supabase] Successfully stored image in database")}catch(r){const n=r instanceof Error?r.message:"Unknown error occurred";F("Image upload",r),console.error("[Supabase] Image upload failed:",r),p(n);try{v.warn("Attempting to store in IndexedDB as fallback",{id:s,contentType:d,error:n},"IndexedDBFallback"),console.log("[Supabase] Attempting to store in IndexedDB as fallback");const{addImage:i}=await q(async()=>{const{addImage:I}=await import("./useImageDB-Cn_3ys7i.js");return{addImage:I}},__vite__mapDeps([0,1]));await i(s,t),U(s,"IndexedDB",!0,{fallbackFromSupabase:!0,dataLength:t.length}),console.log("[Supabase] Successfully stored in IndexedDB as fallback")}catch(i){F("IndexedDB fallback",i),console.error("[Supabase] IndexedDB fallback failed:",i),U(s,"IndexedDB",!1,{error:i instanceof Error?i.message:"Unknown error"})}throw r}finally{c(!1)}}),getImage:async s=>M("getImage",async()=>{c(!0),p(null),A("getImage",{id:s});try{const t=await C.getImage(s);if(t){const d=t.startsWith("http");v.image("Image retrieved successfully",{id:s,type:d?"URL reference":"Base64 data",dataLength:t.length,preview:d?t:t.substring(0,30)+"..."},"SupabaseGet")}else v.warn("Image not found",{id:s},"SupabaseGet");return t}catch(t){const d=t instanceof Error?t.message:"Unknown error occurred";F("getImage",t),p(d);return}finally{c(!1)}}),deleteImage:async s=>M("deleteImage",async()=>{c(!0),p(null),A("deleteImage",{id:s});try{const t=await C.getImage(s);t&&t.startsWith("https://")&&(v.image("Deleting image from Storage",{id:s,url:t},"SupabaseDelete"),await O.deleteImage(s),v.image("Image deleted from Storage",{id:s},"SupabaseDelete")),v.image("Deleting image from Database",{id:s},"SupabaseDelete"),await C.deleteImage(s),v.image("Image deleted from Database",{id:s},"SupabaseDelete")}catch(t){const d=t instanceof Error?t.message:"Unknown error occurred";throw F("deleteImage",t),p(d),t}finally{c(!1)}}),isLoading:m,error:b}},ee=()=>{const{currentUser:m}=P(),[c,b]=h.useState([]),[p,x]=h.useState(!0),[S,u]=h.useState(null);return h.useEffect(()=>{(async()=>{x(!0);try{const n=m==null?void 0:m.username,i=await $.getContents(n);b(i)}catch(n){const i=n instanceof Error?n.message:"Unknown error occurred";u(i),console.error("[Supabase] Failed to load contents:",n)}finally{x(!1)}})()},[m]),{contents:c,setContents:b,saveContent:async r=>{x(!0),u(null);try{const n=m==null?void 0:m.username;await $.saveContent(r,n),b(i=>{const I=i.findIndex(g=>g.id===r.id);if(I>=0){const g=[...i];return g[I]=r,g}else return[...i,r]})}catch(n){const i=n instanceof Error?n.message:"Unknown error occurred";throw u(i),n}finally{x(!1)}},deleteContent:async r=>{x(!0),u(null);try{await $.deleteContent(r),b(n=>n.filter(i=>i.id!==r))}catch(n){const i=n instanceof Error?n.message:"Unknown error occurred";throw u(i),n}finally{x(!1)}},saveAllContents:async()=>{x(!0),u(null);try{const r=m==null?void 0:m.username;await $.saveContents(c,r)}catch(r){const n=r instanceof Error?r.message:"Unknown error occurred";throw u(n),r}finally{x(!1)}},isLoading:p,error:S}},ie=()=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-gray-900 dark:text-white",children:"Admin Dashboard"}),e.jsx(ae,{})]}),ae=()=>{const{currentUser:m}=P(),{showToast:c}=H();K();const{addImage:b,getImage:p,deleteImage:x}=Z(),{contents:S,saveContent:u,deleteContent:s}=ee(),[t,d]=h.useState(null),[r,n]=h.useState(),[i,I]=h.useState({}),g=S.find(a=>a.type==="banner"),N=S.filter(a=>a.type==="scanner").sort((a,o)=>o.updatedAt-a.updatedAt);h.useEffect(()=>{g!=null&&g.imageId&&!r&&(console.log("[Image Load] Loading banner image:",g.imageId),p(g.imageId).then(a=>{a?(console.log("[Image Load] Banner image loaded successfully"),n(a)):console.warn("[Image Load] Banner image not found in Supabase")}).catch(a=>{console.error("[Image Load] Failed to load banner image:",a),c("error","Failed to load banner image")}))},[g==null?void 0:g.imageId,r,p,c]),h.useEffect(()=>{N.forEach(a=>{a.imageId&&!i[a.imageId]&&(console.log("[Image Load] Loading scanner image:",a.imageId),p(a.imageId).then(o=>{o?(console.log("[Image Load] Scanner image loaded:",a.imageId),I(l=>a.imageId?{...l,[a.imageId]:o}:l)):console.warn("[Image Load] Scanner image not found:",a.imageId)}).catch(o=>{console.error("[Image Load] Failed to load scanner image:",o),c("error","Failed to load scanner image")}))})},[N,i,p,c]);const L=async(a,o)=>{if(o)try{d({type:a,progress:0}),console.log(`[Upload] Starting ${a} image upload: ${o.name} (${o.size} bytes)`),await new Promise((l,f)=>{J(o,async w=>{console.log("[Upload] Image processed successfully, data URL length:",w.length);const k=`${a}-${Date.now()}`;try{console.log(`[Upload] Attempting to store image in Supabase with ID: ${k}`);let D=!0;try{await b(k,w,a),console.log("[Upload] Image successfully stored in Supabase:",k)}catch(j){console.error("[Upload] Supabase storage failed:",j),D=!1,console.log("[Upload] Falling back to localStorage for image storage"),localStorage.setItem(`image_${k}`,w),console.log("[Upload] Image stored in localStorage as fallback"),c("info","Image stored locally. It may not persist across devices.")}const z={id:crypto.randomUUID(),type:a,title:o.name,content:"",imageId:k,scale:1,createdAt:Date.now(),updatedAt:Date.now()};if(a==="banner"&&g){console.log("[Upload] Removing old banner image:",g.id);try{await s(g.id),g.imageId&&await x(g.imageId),console.log("[Upload] Old banner image removed successfully")}catch(j){console.error("[Upload] Error removing old banner:",j)}}let R=!0;try{console.log("[Upload] Saving content metadata to Supabase"),await u(z),console.log("[Upload] Content metadata saved successfully")}catch(j){console.error("[Upload] Error saving content metadata:",j),R=!1,console.log("[Upload] Falling back to localStorage for content metadata");const _=JSON.parse(localStorage.getItem("admin_contents")||"[]");_.push(z),localStorage.setItem("admin_contents",JSON.stringify(_)),console.log("[Upload] Content metadata stored in localStorage as fallback")}console.log("[Upload] Updating UI with new image"),a==="banner"?n(w):I(j=>({...j,[k]:w})),(!D||!R)&&c("info","Image uploaded with limited persistence. Check console for details."),console.log("[Upload] Upload process completed successfully"),l()}catch(D){console.error("[Upload] Critical error in upload process:",D),f(D)}})}),c("success",`${a==="banner"?"Banner":"Scanner"} image uploaded successfully`)}catch(l){console.error("[Upload] Content upload failed:",l),d(f=>f?{...f,error:"Upload failed"}:null),c("error","Failed to upload content")}finally{d(null)}},B=async(a,o)=>{try{console.log("[Delete] Deleting content:",{id:a,type:o});const l=S.find(f=>f.id===a);l!=null&&l.imageId&&(await x(l.imageId),console.log("[Delete] Image deleted from Supabase:",l.imageId),l.type==="banner"?n(void 0):I(f=>{if(!l.imageId)return f;const{[l.imageId]:w,...k}=f;return k})),await s(a),c("success","Content deleted successfully")}catch(l){console.error("[Delete] Failed to delete content:",l),c("error","Failed to delete content")}},E=async(a,o)=>{console.log("[Scale] Updating scale:",{id:a.id,scale:o});try{const l={...a,scale:o,updatedAt:Date.now()};await u(l),c("success","Scale updated successfully")}catch(l){console.error("[Scale] Failed to save scale update:",l),c("error","Failed to save scale change")}};return m!=null&&m.isOwner?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Banner Image"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"The banner image appears at the top of the main page and sets the tone for your scanner template. Upload an eye-catching image here."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(V,{onFileSelect:a=>L("banner",a),accept:"image/*",maxSize:5,isLoading:(t==null?void 0:t.type)==="banner",label:"Drag & drop a banner image or click to browse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200",children:"Current Banner"}),g&&r?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:r,alt:"Banner",className:"w-full h-auto rounded-lg border border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 rounded-lg flex items-center justify-center",children:e.jsx("button",{onClick:()=>B(g.id,"banner"),className:"bg-red-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300","aria-label":"Delete banner",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),g.scale!==void 0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Scale: ",g.scale.toFixed(1)]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:g.scale,onChange:a=>E(g,parseFloat(a.target.value)),className:"w-full"})]})]}):e.jsx("div",{className:"border border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center text-gray-500 dark:text-gray-400",children:"No banner image uploaded"})]})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Scanner Variations"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"A scanner's data can be visualized in a variety of ways. Upload different scanner variation images to display on the main page."}),e.jsx("div",{className:"mb-6",children:e.jsx(V,{onFileSelect:a=>L("scanner",a),accept:"image/*",maxSize:5,isLoading:(t==null?void 0:t.type)==="scanner",label:"Drag & drop a scanner image or click to browse"})}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:"Current Scanner Images"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[N.map(a=>e.jsx("div",{className:"relative group bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:a.imageId&&i[a.imageId]?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative aspect-square overflow-hidden rounded-lg mb-2",children:[e.jsx("img",{src:a.imageId?i[a.imageId]:"",alt:a.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center",children:e.jsx("button",{onClick:()=>B(a.id,"scanner"),className:"bg-red-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300","aria-label":"Delete scanner image",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 truncate mb-1",children:a.title}),a.scale!==void 0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Scale: ",a.scale.toFixed(1)]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:a.scale,onChange:o=>E(a,parseFloat(o.target.value)),className:"w-full"})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})})},a.id)),N.length===0&&e.jsx("div",{className:"col-span-full border border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center text-gray-500 dark:text-gray-400",children:"No scanner images uploaded"})]})]})]}):e.jsx("div",{className:"p-8 text-center text-gray-900 dark:text-white",children:"You don't have permission to access this page."})};export{ie as default};

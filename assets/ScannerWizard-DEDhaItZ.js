var W=Object.defineProperty;var _=(a,s,o)=>s in a?W(a,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[s]=o;var L=(a,s,o)=>_(a,typeof s!="symbol"?s+"":s,o);import{j as e,A as R,a as i,m as C}from"./vendor-BWCFR02q.js";import{a as A,b as J,u as V,c as q,T as Y}from"./index-BDHP0l7E.js";import{c as K}from"./imageHandlers-mTahlW39.js";const G={hidden:{opacity:0},visible:{opacity:1}},H={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},X=({isOpen:a,onClose:s,title:o,children:m,footer:g,size:l="md",showCloseButton:c=!0})=>{const d={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[l];return e.jsx(R,{mode:"wait",children:a&&e.jsxs(i.Fragment,{children:[e.jsx(C.div,{variants:G,initial:"hidden",animate:"visible",exit:"hidden",onClick:s,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(C.div,{variants:H,initial:"hidden",animate:"visible",exit:"exit",className:`${d} w-full bg-white rounded-lg shadow-xl`,onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:o}),c&&e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:m}),g&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:g})]})})]})})};class Z{constructor(s=100){L(this,"cache");L(this,"maxSize");this.cache=new Map,this.maxSize=s}get(s){const o=this.cache.get(s);if(o){if(o.expiry&&Date.now()>o.expiry){this.cache.delete(s);return}return this.cache.delete(s),this.cache.set(s,o),o.value}}set(s,o,m=null){if(this.cache.size>=this.maxSize){const l=this.cache.keys().next().value;l&&this.cache.delete(l)}const g=m?Date.now()+m:null;this.cache.set(s,{value:o,expiry:g})}clear(){this.cache.clear()}}function S(a,s={}){const{maxCacheSize:o=100,ttl:m=null}=s,g=new Z(o),l=(...c)=>{const d=JSON.stringify(c),h=g.get(d);if(h!==void 0)return h;const u=a(...c);return u instanceof Promise?(g.set(d,u,m),u.then(p=>(g.set(d,p,m),p)).catch(p=>{throw g.get(d)===u&&g.set(d,void 0,0),p})):(g.set(d,u,m),u)};return l.clearCache=()=>{g.clear()},l}const ee=()=>{const[a,s]=i.useState([]);i.useEffect(()=>{const t=()=>{const x=localStorage.getItem("admin_contents");x&&s(JSON.parse(x))};t();const n=x=>{x.key==="admin_contents"&&t()};return window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},[]);const o=i.useMemo(()=>S(t=>t.filter(n=>n.type==="banner")),[]),m=i.useCallback(()=>{const t=o(a);if(t.length===0)return null;const n=t[t.length-1];return console.log("Retrieved banner image:",{id:n.id,imageUrl:n.imageUrl?n.imageUrl.substring(0,30)+"...":"none",title:n.title,scale:n.scale,displayText:n.displayText}),{id:n.id,src:n.imageUrl||"",alt:n.title,scale:n.scale||1,displayText:n.displayText}},[a,o]),g=i.useMemo(()=>S(t=>t.filter(n=>n.type==="scanner")),[]),l=i.useMemo(()=>S(t=>[...t].sort((n,x)=>x.updatedAt-n.updatedAt)),[]),c=i.useMemo(()=>S(t=>t.map(x=>{const j={id:x.id,src:x.imageUrl||"",alt:x.title||"Image",scale:x.scale||1,displayText:x.displayText||""};return console.log(`Transformed image ${x.id}:`,{src:j.src?j.src.substring(0,30)+"...":"none",scale:j.scale}),j})),[]),d=i.useCallback(()=>{const t=g(a),n=l(t);return console.log("Retrieved scanner images:",t.length),t.length>0&&console.log("First scanner image:",{id:t[0].id,imageUrl:t[0].imageUrl?t[0].imageUrl.substring(0,30)+"...":"none",title:t[0].title,scale:t[0].scale,displayText:t[0].displayText}),c(n)},[a,g,l,c]),h=i.useMemo(()=>S(t=>t.filter(n=>n.type==="template")),[]),u=i.useMemo(()=>S(t=>t.map(n=>({id:n.id,title:n.title,code:n.content}))),[]),p=i.useCallback(()=>{const t=h(a),n=l(t);return u(n)},[a,h,l,u]),b=i.useMemo(()=>S(t=>t.filter(n=>n.type==="question")),[]),y=i.useMemo(()=>S(t=>t.map(n=>({id:n.id,title:n.title,text:n.content}))),[]),f=i.useCallback(()=>{const t=b(a),n=l(t);return y(n)},[a,b,l,y]);return i.useMemo(()=>({getBannerImage:m,getScannerImages:d,getTemplates:p,getQuestions:f,hasContent:a.length>0}),[m,d,p,f,a.length])},te=()=>{const{state:a}=A(),{answers:s,sections:o,questions:m}=a,g=i.useMemo(()=>S(b=>b.filter(y=>y.isMandatory)),[]),l=i.useMemo(()=>S((b,y)=>b.find(f=>f.id===y)),[]),c=i.useMemo(()=>S((b,y)=>b.find(f=>f.id===y)),[]),d=i.useCallback((b,y,f)=>{const v=new RegExp(`{{\\s*${y}\\s*}}`,"g");return b.replace(v,f)},[]),h=i.useCallback(b=>{let y="";const f=new Set;return b.forEach(v=>{y+=`// --- Section: ${v.title} (Mandatory) ---
`,y+=v.code+`

`,f.add(v.id)}),{code:y,includedIds:f}},[]),u=i.useCallback((b,y,f,v)=>{let t="";return Object.entries(b).forEach(([n,x])=>{const j=l(y,n);if(!j)return;let I;if(j.type==="choice"&&x?(Array.isArray(x)?x:[x]).forEach(N=>{var M;const T=(M=j.options)==null?void 0:M.find(P=>P.value===N);T!=null&&T.linkedSectionId&&(I=T.linkedSectionId)}):(j.type==="text"||j.type==="boolean")&&j.linkedSectionId&&(I=j.linkedSectionId),I&&!v.has(I)){const E=c(f,I);if(E){let N=E.code;j.type==="text"&&j.placeholderVariable&&typeof x=="string"&&(N=d(N,j.placeholderVariable,x)),t+=`// --- Section: ${E.title} (Linked by: ${j.text.substring(0,20)}...) ---
`,t+=N+`

`,v.add(E.id)}}else j.type==="text"&&j.placeholderVariable&&typeof x=="string"&&!I&&(t+=`// User input for "${j.text.substring(0,20)}...": ${x}

`)}),t},[l,c,d]),p=i.useMemo(()=>{const b=g(o),{code:y,includedIds:f}=h(b),v=u(s,m,o,f);return(y+v).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[s,o,m,g,h,u]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:p})})]})},ae=()=>{const[a,s]=i.useState(()=>{const l=localStorage.getItem("admin_questions");return l?JSON.parse(l):[]});return i.useEffect(()=>{localStorage.setItem("admin_questions",JSON.stringify(a))},[a]),i.useEffect(()=>()=>{a.forEach(l=>{var c;(c=l.options)==null||c.forEach(d=>{d.imagePreview&&K(d.imagePreview)})})},[a]),{questions:a,setQuestions:s,addQuestion:l=>{const c={id:`question-${Date.now()}`,type:l,text:"",required:!1,...l==="choice"&&{options:[]},...l==="text"&&{placeholderVariable:""}};s(d=>[...d,c])},updateQuestion:(l,c)=>{s(d=>d.map(h=>h.id===l?{...h,...c}:h))},deleteQuestion:l=>{s(c=>c.filter(d=>d.id!==l))}}},se=()=>{const[a,s]=i.useState(()=>{const c=localStorage.getItem("admin_sections");return c?JSON.parse(c):[]});return i.useEffect(()=>{localStorage.setItem("admin_sections",JSON.stringify(a))},[a]),{sections:a,setSections:s,addSection:()=>{const c={id:`section-${Date.now()}`,title:"New Section",code:"",isMandatory:!1};s(d=>[...d,c])},updateSection:(c,d)=>{s(h=>h.map(u=>u.id===c?{...u,...d}:u))},deleteSection:c=>{s(d=>d.filter(h=>h.id!==c))},reorderSections:c=>{s(c)}}},re=()=>{const{getImage:a}=J(),[s,o]=i.useState({}),[m,g]=i.useState(!0),[l,c]=i.useState(null),d=()=>{try{const u=localStorage.getItem("admin_contents");return u?JSON.parse(u):[]}catch(u){return console.error("Failed to load content metadata:",u),[]}};return i.useEffect(()=>{(async()=>{g(!0),c(null);try{const b=d().filter(t=>t.type==="banner"||t.type==="scanner").map(t=>t.imageId).filter(Boolean);console.log("[ImageBridge] Loading images:",b);const y=b.map(async t=>{if(!t)return null;try{const n=await a(t);return n?{imageId:t,imageData:n}:(console.warn(`[ImageBridge] Image not found: ${t}`),null)}catch(n){return console.error(`[ImageBridge] Failed to load image ${t}:`,n),null}}),f=await Promise.all(y),v={};f.forEach(t=>{t&&(v[t.imageId]=t.imageData)}),o(v),console.log("[ImageBridge] Images loaded:",Object.keys(v).length)}catch(p){console.error("[ImageBridge] Failed to load images:",p),c("Failed to load images")}finally{g(!1)}})()},[a]),{imageCache:s,loading:m,error:l,getImageForContent:u=>{if(!u.imageId)return console.warn("[ImageBridge] Content has no imageId:",u.id),null;const p=s[u.imageId];return p||(console.warn("[ImageBridge] Image not found in cache:",u.imageId),null)}}},F=({label:a,error:s,helperText:o,required:m,children:g,fullWidth:l=!1})=>e.jsxs("div",{className:`${l?"w-full":""} space-y-1`,children:[a&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[a,m&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("div",{className:"mt-1",children:g}),(s||o)&&e.jsx("div",{className:"mt-1",children:s?e.jsx(C.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-red-600",children:s}):o?e.jsx("p",{className:"text-sm text-gray-500",children:o}):null})]}),ne=({label:a,error:s,helperText:o,required:m,fullWidth:g,...l})=>e.jsx(F,{label:a,error:s,helperText:o,required:m,fullWidth:g,children:e.jsx("input",{className:`
          block rounded-md shadow-sm
          ${g?"w-full":"w-auto"}
          ${s?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...l})}),ie=({label:a,error:s,helperText:o,required:m,...g})=>e.jsx(F,{error:s,helperText:o,required:m,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:`
            rounded border-gray-300 text-blue-600 shadow-sm
            focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 focus:ring-opacity-50
            ${s?"border-red-500":""}
          `,...g}),a&&e.jsxs("label",{className:"ml-2 block text-sm text-gray-900",children:[a,m&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]})}),Q=({src:a,alt:s,scale:o=1,className:m="",style:g={}})=>{const[l,c]=i.useState(""),[d,h]=i.useState(!0),[u,p]=i.useState(null);i.useEffect(()=>{if(h(!0),p(null),!a){p("No image source provided"),h(!1);return}try{a.startsWith("http")||a.startsWith("data:")||a.startsWith("blob:")?(c(a),h(!1)):(a.startsWith("/9j/")||a.startsWith("iVBOR")?c(`data:image/jpeg;base64,${a}`):c(a),h(!1))}catch(y){console.error("Error setting image source:",y),p("Failed to load image"),h(!1)}},[a]);const b={...g,transform:`scale(${o})`,transformOrigin:"center center"};return d?e.jsx("div",{className:`flex items-center justify-center bg-gray-100 dark:bg-gray-700 ${m}`,children:e.jsx("div",{className:"animate-pulse text-gray-400 dark:text-gray-500",children:"Loading..."})}):u?e.jsx("div",{className:`flex items-center justify-center bg-gray-100 dark:bg-gray-700 ${m}`,children:e.jsx("div",{className:"text-red-500",children:u})}):e.jsx("img",{src:l,alt:s,className:m,style:b,onError:()=>{console.error("Image failed to load:",a),p("Failed to load image")}})},oe={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},O={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},me=()=>{const{getBannerImage:a,getScannerImages:s}=ee(),{imageCache:o,loading:m}=re();V();const{theme:g}=q(),{state:l,dispatch:c}=A(),{questions:d}=ae(),{sections:h}=se(),[u,p]=i.useState(null),[b,y]=i.useState("");i.useEffect(()=>{c({type:"SET_QUESTIONS",payload:d})},[d,c]),i.useEffect(()=>{c({type:"SET_SECTIONS",payload:h})},[h,c]);const[f,v]=i.useState(null),[t,n]=i.useState(null),[x,j]=i.useState([]),[I,E]=i.useState({}),[N,T]=i.useState(1),M=6;i.useEffect(()=>{try{const r=a();v(r);const w=s();j(w),console.log("Content metadata loaded:",{bannerFound:!!r,scannerImagesCount:w.length})}catch(r){console.error("Error loading content metadata:",r),v(null),j([])}},[a,s]),i.useEffect(()=>{if(!m&&Object.keys(o).length>0){if(console.log("Image cache loaded:",Object.keys(o).length,"images"),f!=null&&f.id){const r=Object.keys(o).find(w=>w.startsWith("banner-"));r&&(n(o[r]),console.log("Banner image data found:",r))}if(x.length>0){const r={};Object.keys(o).filter($=>$.startsWith("scanner-")).forEach(($,k)=>{k<x.length&&(r[x[k].id]=o[$])}),E(r),console.log("Scanner image data found:",Object.keys(r).length,"images")}}},[o,m,f,x]);const P=()=>{const r=(N-1)*M;return x.slice(r,r+M)},B=Math.ceil(x.length/M),z=r=>{T(r)},D=(r,w)=>{c({type:"SET_ANSWER",payload:{questionId:r,value:w}})},U=r=>{var $;const w=l.answers[r.id];switch(r.type){case"text":return e.jsx(ne,{label:r.text,value:w||"",onChange:k=>D(r.id,k.target.value),required:r.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.text," ",r.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:($=r.options)==null?void 0:$.map(k=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${w===k.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:r.id,value:k.value,checked:w===k.value,onChange:()=>D(r.id,k.value),className:"sr-only"}),k.imageUrl&&e.jsx("img",{src:k.imagePreview||k.imageUrl,alt:k.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${k.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:k.text})]},k.id))})]});case"boolean":return e.jsx(ie,{label:r.text,checked:!!w,onChange:k=>D(r.id,k.target.checked),required:r.required});default:return null}};return e.jsx("div",{className:g==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200",children:[e.jsx(Y,{}),e.jsxs(C.div,{variants:oe,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(C.div,{variants:O,className:"py-12 px-4 text-center",children:e.jsx("h1",{className:"text-5xl md:text-6xl lg:text-7xl font-bold text-gray-900 dark:text-white font-display tracking-tight",children:"COMET Scanner Template Wizard"})}),e.jsxs(C.div,{variants:O,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800",children:[m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800 bg-opacity-75 dark:bg-opacity-75 z-10",children:e.jsx("div",{className:"text-blue-600 dark:text-blue-400 text-xl font-medium",children:"Loading images..."})}),t?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx(Q,{src:t,alt:"COMET Scanner Banner",scale:(f==null?void 0:f.scale)||1,className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300"})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold",children:"Visualize Your Data with COMET Scanner"})})})]}),Object.keys(I).length>0&&e.jsxs(C.div,{variants:O,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-8 text-center",children:"Scanner Variations"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:P().map(r=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transform transition-transform hover:scale-105",onClick:()=>{p(I[r.id]||""),y(r.displayText||"Scanner Variation")},children:[e.jsx("div",{className:"aspect-video bg-gray-100 dark:bg-gray-700 relative overflow-hidden",children:e.jsx(Q,{src:I[r.id]||"",alt:r.alt,scale:r.scale||1,className:"w-full h-full object-contain"})}),r.displayText&&e.jsx("div",{className:"p-4",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:r.displayText})})]},r.id))}),B>1&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>z(Math.max(1,N-1)),disabled:N===1,className:`px-3 py-1 rounded ${N===1?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:"Previous"}),Array.from({length:B},(r,w)=>w+1).map(r=>e.jsx("button",{onClick:()=>z(r),className:`w-8 h-8 rounded flex items-center justify-center ${r===N?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:r},r)),e.jsx("button",{onClick:()=>z(Math.min(B,N+1)),disabled:N===B,className:`px-3 py-1 rounded ${N===B?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:"Next"})]})})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(C.div,{variants:O,children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-6",children:"Configure Your Template"}),e.jsxs("div",{className:"space-y-6",children:[l.questions.map(r=>e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:U(r)},r.id)),l.questions.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions configured yet. Please set them up in the Admin Dashboard."})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(te,{})})]})]}),u&&e.jsx(X,{isOpen:!0,onClose:()=>{p(null),y("")},title:b,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx(Q,{src:u||"",alt:b,className:"max-w-full max-h-[80vh] object-contain"})})})})]})})};export{me as default};
//# sourceMappingURL=ScannerWizard-DEDhaItZ.js.map
